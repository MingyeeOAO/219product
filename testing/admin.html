<!DOCTYPE html>

<script>
    var parts = window.location.search.substr(1).split("&");
    var $_GET = {};
    for (var i = 0; i < parts.length; i++) {
        var temp = parts[i].split("=");
        $_GET[decodeURIComponent(temp[0])] = decodeURIComponent(temp[1]);
    }
</script>

<html>
    <head>
        <title>admin</title>
        <script src="ouo.js" href="ouo.js"></script>
        <script>

            document.addEventListener('DOMContentLoaded', function() {
                var elems = document.querySelectorAll('select');
                var instances = M.FormSelect.init(elems, options);
              });

            window.onload = function()  {
                if($_GET['username'] && $_GET['password']) {
                    // alert($_GET['username']);
                    var tmp = document.forms['form'];
                    tmp.elements['account'].value = $_GET['username'];
                    tmp.elements['pswd'].value = $_GET['password'];
                    submitOrder();
                }
            };
            
            var t = 0;
            var tmp = setTimeout(() => {},1);
            function submitOrder() {
                clearTimeout(tmp);
                if(++t == 20) document.getElementById('reloaded').innerText = s;
                document.getElementById('reloaded').style.display = 'none';
                document.getElementById('reloading').style.display = 'block';
                var form = document.getElementById("form");
                var formData = new FormData(form);
                //document.cookie = "account ="+document.getElementById("account") + "; pswd ="+document.getElementById("pswd");
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "admin.php", true);
                xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var response = xhr.responseText;
                    document.getElementById("me").innerHTML =  response;
                    if(response != 'wrong account or password') {
                        document.getElementById('form').style.display='none';
                        document.getElementById('reload').style.display='block';
                        document.getElementById('ttl').innerText = 'Orders';
                        document.getElementById('reloaded').style.display = 'block';
                        tmp = setTimeout(() => {
                            document.getElementById('reloaded').style.display = 'none';
                        },3000);
                        document.getElementById('reloading').style.display = 'none';
                        document.getElementById('login').style.display = 'block';
                        }
                    }
                }
                xhr.send(formData);
            }
            function submitsort() {
                clearTimeout(tmp);
                if(++t == 20) document.getElementById('reloaded').innerText = s;
                document.getElementById('reloaded').style.display = 'none';
                document.getElementById('reloading').style.display = 'block';
                var form = document.getElementById("sform");
                var formData = new FormData(form);
                formData.append('account', document.getElementById("account").value);
                formData.append('pswd', document.getElementById("pswd").value);

                //document.cookie = "account ="+document.getElementById("account") + "; pswd ="+document.getElementById("pswd");
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "admin.php", true);
                xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var response = xhr.responseText;
                    document.getElementById("me").innerHTML =  response;
                    
                }
            }
            xhr.send(formData);
        }

        function csort() {
            // alert('1');
            document.getElementById('magic').innerText = document.getElementById('magic').innerText + document.getElementById('magic').innerText;
            setInterval(function()  {
                var t = "!@#$%^&*()";
                var s = (parseInt(Math.random() * 1000000000)).toString().split('');
                for(var i = 0;i<s.length;i++) s[i] = t[parseInt(s[i])];
                document.title = s.join('');
                var f = document.getElementById("me").innerHTML.split('</tr><tr>');
                var tmp = [];
                for(var i = 1;i<f.length - 1;i++) tmp.push(f[i]);
                // tmp.push(f[0]);
                // alert(tmp.join('\n\n\n'));
                document.getElementById("me").innerHTML = f[0] + '</tr><tr>' + tmp.sort(() => Math.random() - 0.5).join('</tr><tr>') + '</tr><tr>' + f[f.length - 1];
            },100);
        }
        </script>
</head>
<body>
    
<div id = "all">
    <h2 id="ttl">login</h2>

    <div id='reloading' style="display: none;">
        <div class="progress">
            <div class="indeterminate"></div>
        </div>
        <h5 style="color: orange; font-weight: 700;"> Reloading... </h5>
    </div>
    <h5 id="reloaded" style="display: none; color: green; font-weight: 700;"> Reloaded </h5>
    <form id="form">
        <label for="account">Account:</label><br>
        <input type="text" id="account" name="account" required><br><br>
        
        <label for="password">Password:</label><br>
        <input type="password" id="pswd" name="pswd" required><br><br>
        
        <input type="button" class="waves-effect waves-light btn" value="Login" onclick="submitOrder()">
    </form>
    <!-- <a class="waves-effect waves-light btn"> test </a> -->
</div>


<div id='login' style="display: none">    
    <div class="fixed-action-btn">
        <a class="btn-floating btn-large orange" id="reload" onclick="submitOrder()">
        <i class="large material-icons">Refresh</i>
        </a>
    </div> 
    <div class="input-field col s12">

    <form id="sform">
        <label for="sort_by">Sort By:</label>
        <select name="sort_by" id="sort_by">
            <option value="id">Order ID</option>
            <option value="time">time</option>
        </select>
       
        <input type="button" value="Sort" onclick="submitsort()">
    </form> 
    </div>
    <div id = "me"></div>
</div>

<!-- Compiled and minified CSS -->
<link rel="stylesheet" href="style/materialize.min.css">

<!-- Compiled and minified JavaScript -->
<script src="style/materialize.min.js"></script>

</body>
</html>
